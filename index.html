<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Nox Studio Ultimate</title>
<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#1f1c2c,#928dab);color:white}
header{text-align:center;padding:20px;background:black}
button{padding:6px 12px;border:none;border-radius:8px;margin:4px;font-weight:bold;cursor:pointer}
button:hover{opacity:.8}
.section{background:rgba(0,0,0,.5);margin:15px;padding:15px;border-radius:15px}
video{width:100%;border-radius:12px;margin-top:10px}
textarea,input{width:100%;padding:6px;border-radius:6px;border:none;margin-top:5px}
.post{background:#00000090;padding:10px;margin-top:10px;border-radius:10px}
.comment{background:#000000aa;padding:5px;margin-top:5px;border-radius:6px}
</style>
</head>
<body>

<header>
<h2>Nox Studio Ultimate</h2>
<div id="userInfo"></div>
<button onclick="openLogin()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
<button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</header>

<div class="section">
<h3>ğŸ“¤ Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</h3>
<input type="file" accept="video/*" onchange="loadVideo(event)">
<video id="video" controls></video>
<textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"></textarea>
<button onclick="publish()">Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
</div>

<div class="section">
<h3>ğŸ¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
<div id="posts"></div>
</div>

<div id="loginBox" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000000d0;justify-content:center;align-items:center">
<div style="background:#111;padding:20px;border-radius:15px;width:280px">
<input id="uid" placeholder="Ø§Ù„Ù…Ø¹Ø±Ù">
<input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="closeLogin()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
</div>

<script>
let db
let users=JSON.parse(localStorage.getItem("users"))||[]
let currentUser=JSON.parse(localStorage.getItem("currentUser"))||null

const request=indexedDB.open("NoxDB",1)

request.onupgradeneeded=e=>{
db=e.target.result
db.createObjectStore("videos",{keyPath:"id"})
}

request.onsuccess=e=>{
db=e.target.result
render()
}

function saveVideoData(data){
let tx=db.transaction("videos","readwrite")
tx.objectStore("videos").put(data)
}

function getAllVideos(callback){
let tx=db.transaction("videos","readonly")
let store=tx.objectStore("videos")
let req=store.getAll()
req.onsuccess=()=>callback(req.result)
}

function deleteVideo(id){
let tx=db.transaction("videos","readwrite")
tx.objectStore("videos").delete(id)
render()
}

function openLogin(){loginBox.style.display="flex"}
function closeLogin(){loginBox.style.display="none"}

function register(){
if(!uid.value||!pass.value)return alert("Ø¹Ø¨ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
if(users.find(u=>u.id==uid.value))return alert("Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…")
users.push({id:uid.value,pass:pass.value})
localStorage.setItem("users",JSON.stringify(users))
alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨")
}

function login(){
let user=users.find(u=>u.id==uid.value&&u.pass==pass.value)
if(user){
currentUser=user.id
localStorage.setItem("currentUser",JSON.stringify(currentUser))
updateUI()
closeLogin()
}else alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙ„Ø·")
}

function logout(){
currentUser=null
localStorage.removeItem("currentUser")
updateUI()
}

function updateUI(){
userInfo.innerHTML=currentUser?"Ù…Ø³Ø¬Ù„: "+currentUser:"ØºÙŠØ± Ù…Ø³Ø¬Ù„"
}

function loadVideo(e){
let file=e.target.files[0]
let reader=new FileReader()
reader.onload=function(){
video.src=reader.result
video.dataset.data=reader.result
}
reader.readAsDataURL(file)
}

function publish(){
if(!currentUser)return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹")
if(!video.dataset.data)return alert("Ø§Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ")

let post={
id:Date.now(),
user:currentUser,
video:video.dataset.data,
desc:desc.value,
comments:[]
}

saveVideoData(post)
render()
}

function render(){
if(!db)return
getAllVideos(data=>{
posts.innerHTML=""
data.forEach(p=>{
let div=document.createElement("div")
div.className="post"
let del=p.user==currentUser?`<button onclick="deleteVideo(${p.id})">Ø­Ø°Ù</button>`:""
div.innerHTML=`
<video src="${p.video}" controls></video>
<p>${p.desc}</p>
${del}`
posts.appendChild(div)
})
})
}

updateUI()
</script>

</body>
</html>
